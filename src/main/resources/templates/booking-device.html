<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Usage Information</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
        <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet"/>
        <title>Bootstrap Example</title>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    </head>
    <body>

        <div class="container">
            <form id="bookingForm" class="d-flex align-items-end mb-3 mt-3" method="post">
                <div class="me-2">
                    <label for="modalBookingTime" class="form-label">Thời gian đặt chỗ</label>
                    <input type="datetime-local" id="modalBookingTime"  class="form-control" name="bookingTime"
                           min="" required>
                </div>
                <button class="btn btn-primary" type="submit">Đồng ý</button>
            </form>

            <form class="d-flex align-items-end mb-3 mt-3">
                <div class="me-2">
                    <label for="search" class="form-label">Tên thiết bị</label>
                    <input type="text" class="form-control" id="search" aria-describedby="search" name="search">
                </div>
                <button class="btn btn-primary" type="submit">Tìm kiếm</button>
            </form>
            <div class="toast-container position-fixed bottom-0 end-0 p-3">
                <div th:if="${errorMessage}"
                     class="toast align-items-center text-bg-danger border-0 fade show"
                     role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body" th:text="${errorMessage}"></div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            </div>
            <div class="toast-container position-fixed bottom-0 end-0 p-3">
                <div th:if="${successMessage}"
                     class="toast align-items-center text-bg-success border-0 fade show"
                     role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body" th:text="${successMessage}"></div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>Mã thiết bị</th>
                        <th>Tên thiết bị</th>

                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="device : ${devices}">
                        <td th:text="${device[0]}"></td>
                        <td th:text="${device[1]}"></td>

                        <td>
                            <button type="button" class="btn btn-primary" onclick="openModal(this)" th:device-id="${device[0]}">Đặt chỗ</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!--        <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="bookingModalLabel">Chọn thời gian đặt chỗ</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="bookingForm" method="post">
                                    <input type="datetime-local" id="modalBookingTime" name="bookingTime"
                                           min="" required>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                <button type="button" class="btn btn-primary" onclick="submitForm()">Đặt chỗ</button>
                            </div>
                        </div>
                    </div>
                </div>-->

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(function () {
                    document.querySelector('.toast-container .toast').classList.remove("show");
                }, 5000);
            });

            function openModal(button) {
                var deviceId = button.getAttribute("device-id");
                var currentDateTime = new Date().toISOString().slice(0, 16).replace("T", " ");
                document.getElementById('modalBookingTime').min = currentDateTime;
                document.querySelector("#bookingForm").setAttribute('action', '/book/' + deviceId);
                var modal = new bootstrap.Modal(document.getElementById('bookingModal'));
                modal.show();
            }

            function submitForm() {
                var selectedDateTime = new Date(document.getElementById('modalBookingTime').value);

                var minimumDateTime = new Date();
                minimumDateTime.setMinutes(minimumDateTime.getMinutes() + 30);
                if (selectedDateTime < minimumDateTime) {
                    alert('Thời gian đặt chỗ phải sau ít nhất 30 phút so với thời gian hiện tại');
                    return;
                }

                document.getElementById('bookingForm').submit();
            }
        </script>
    </body>
</html>
